<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>3-3 ã€Œå¹´é½¡å•é¡Œã€åˆ—å¼æŒ‘æˆ°è³½</title>
<style>
/* å®Œå…¨é‚„åŸæ‚¨åŸæœ¬çš„ç²¾ç¾æ¨£å¼ */
:root { --c-blue:#4dabf7; --c-bg:#e7f5ff; --c-text:#1971c2; --c-org:#ff922b; --c-org-bg:#fff4e6; --c-org-text:#d9480f; --c-alert:#e03131; }
body { margin: 0; padding: 0; background: var(--c-bg); font-family: 'Microsoft JhengHei', sans-serif; user-select: none; -webkit-user-select: none; }
#game-simplify { max-width:850px; margin:20px auto; padding:30px; border:5px solid #f1f3f5; border-radius:20px; text-align:center; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.08); position:relative; overflow:hidden; }
.pg-title { font-size:2.5rem; color:#ff0000; margin-bottom:30px; font-weight:900; text-shadow:2px 2px 4px rgba(0,0,0,0.15); line-height: 1.3; }
.pg-input-group { display:flex; justify-content:center; gap:20px; margin-bottom:30px; }
.pg-input-wrap input { width:130px; font-size:2.2rem; text-align:center; padding:10px; border:3px solid #ddd; border-radius:12px; font-weight:bold; }
.pg-btn-start { border:none; padding:15px 40px; font-size:2rem; border-radius:15px; cursor:pointer; font-weight:bold; background:#5c7cfa; color:white; }
.pg-header { display:flex; gap:15px; margin-bottom:20px; position:relative; }
.pg-info-card { flex:1; background:var(--c-bg); color:var(--c-text); padding:15px; border-radius:15px; font-weight:bold; border:2px solid var(--c-blue); }
.pg-info-card .value { font-size:3.5rem; line-height:1.1; }
#pg-problem-text { font-size: 1.8rem; font-weight: bold; margin: 20px 0 30px; color: #333; line-height: 1.8; text-align: center; min-height: 80px; display: block; }
.fraction { display: inline-block; vertical-align: middle; text-align: center; font-size: 0.9em; }
.fraction .top { display: block; border-bottom: 2px solid currentColor; padding: 0 2px; line-height: 1; }
.fraction .bottom { display: block; padding: 0 2px; line-height: 1; }
.pg-options-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.pg-opt-btn { background:#fff; border:3px solid var(--c-blue); color:var(--c-text); font-size:1.4rem; padding:15px 5px; border-radius:15px; cursor:pointer; font-weight:bold; min-height: 80px; display:flex; justify-content:center; align-items:center; }
.pg-correct { background:#40c057!important; color:#fff!important; }
.pg-wrong { background:#fa5252!important; color:#fff!important; }
/* ç«é›èˆ‡é€£æ“Šå‹•ç•« */
#pg-combo-box { position:absolute; right:-20px; top:-15px; background:#ffec99; border:4px solid #e67700; border-radius:50%; width:100px; height:100px; display:flex; flex-direction:column; justify-content:center; align-items:center; transform:rotate(15deg); z-index:10; }
.combo-hide { display:none!important; }
.turkey-hide { display:none!important; }
#turkey-overlay { position:absolute; top:15px; left:15px; z-index:999; pointer-events:none; }
.turkey-content { display:flex; align-items:center; gap:10px; background:rgba(255,236,153,0.98); border:3px solid #e67700; border-radius:40px; padding:8px 25px; box-shadow:0 8px 15px rgba(0,0,0,0.2); animation:popInCorner 0.5s; }
@keyframes popInCorner { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
</style>
</head>
<body oncontextmenu="return false;">

<div id="game-simplify">
  <div id="pg-login-view">
    <h1 class="pg-title">3-3 ã€Œå¹´é½¡å•é¡Œã€åˆ—å¼æŒ‘æˆ°è³½</h1>
    <div class="pg-input-group">
      <div class="pg-input-wrap"><input type="tel" id="pg-class" placeholder="ç­ç´š"></div>
      <div class="pg-input-wrap"><input type="tel" id="pg-seat" placeholder="åº§è™Ÿ"></div>
    </div>
    <button class="pg-btn-start" onclick="GameSimp.start()">é–‹å§‹æŒ‘æˆ°</button>
  </div>

  <div id="pg-game-view" style="display:none;">
    <div class="pg-header">
      <div class="pg-info-card"><span class="label">å€’æ•¸</span><span class="value" id="pg-timer">60</span></div>
      <div class="pg-info-card"><span class="label">å¾—åˆ†</span><span class="value" id="pg-score">0</span></div>
      <div id="pg-combo-box" class="combo-hide">
        <div class="combo-val" id="pg-combo-num">0</div>
      </div>
    </div>
    <div id="pg-problem-text"></div>
    <div class="pg-options-grid" id="pg-options"></div>
    <div id="turkey-overlay" class="turkey-hide">
      <div class="turkey-content"><span>ğŸ¦ƒ</span><div id="turkey-msg"></div></div>
    </div>
  </div>

  <div id="pg-result-view" style="display:none;">
    <h1 class="pg-title">æŒ‘æˆ°çµæŸ</h1>
    <h2 id="pg-final-student-id"></h2>
    <div style="font-size:5rem; color:red;" id="pg-final-score-num">0</div>
    <button class="pg-btn-start" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
  </div>
</div>

<script>
var GameSimp = (function() {
  var score=0, time=60, timer=null, playing=false, ans="", audioCtx=null, combo=0;

  function _getFrac(t, b) { return `<span class="fraction"><span class="top">${t}</span><span class="bottom">${b}</span></span>`; }
  function _rand(m, n) { return Math.floor(Math.random() * (n - m + 1)) + m; }

  // èªéŸ³èˆ‡éŸ³æ•ˆé‚„åŸ
  function speak(t) { window.speechSynthesis.cancel(); var u = new SpeechSynthesisUtterance(t); u.lang='zh-TW'; u.rate=1.4; window.speechSynthesis.speak(u); }
  function initAudio() { if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)(); }
  function playBeep(f, d) { if(!audioCtx) return; var o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='sine'; o.frequency.value=f; g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+d); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+d); }

  function generate() {
    var r=[{b:"çˆ¶è¦ª",s:"å…’å­"},{b:"æ¯è¦ª",s:"å¥³å…’"},{b:"çˆºçˆº",s:"å­«å­"}][_rand(0,2)];
    var t=_rand(0,2), qO={};
    if(t==0){
      var d=_rand(20,35), s=_rand(50,85);
      qO={q:`${r.b}æ¯”${r.s}å¤§ ${d} æ­²ï¼Œå…©äººå¹´é½¡å’Œç‚º ${s} æ­²ã€‚è‹¥${r.s}ä»Šå¹´ x æ­²ã€‚`, a:`x + (x + ${d}) = ${s}`, o:[`x + (x + ${d}) = ${s}`, `x + (x - ${d}) = ${s}`, `2x = ${s} + ${d}`, `x + x = ${s} - ${d}`]};
    } else if(t==1){
      var m=_rand(2,4), tt=_rand(40,80);
      qO={q:`${r.b}çš„å¹´é½¡æ˜¯${r.s}çš„ ${m} å€ï¼Œå…©äººå¹´é½¡å’Œç‚º ${tt} æ­²ã€‚è‹¥${r.s}ä»Šå¹´ x æ­²ã€‚`, a:`x + ${m}x = ${tt}`, o:[`x + ${m}x = ${tt}`, `x + ${_getFrac('x',m)} = ${tt}`, `${m}x - x = ${tt}`, `x + (x + ${m}) = ${tt}`]};
    } else {
      var y=_rand(3,8), mt=_rand(2,3), d2=_rand(25,35);
      qO={q:`${r.b}ä»Šå¹´ ${d2} æ­²ï¼Œ${r.s}ä»Šå¹´ x æ­²ã€‚<span style="color:red;">${y}å¹´å¾Œ</span>ï¼Œ${r.b}æ˜¯${r.s}çš„ ${mt} å€ã€‚`, a:`${d2} + ${y} = ${mt}(x + ${y})`, o:[`${d2} + ${y} = ${mt}(x + ${y})`, `${d2} + ${y} = ${mt}x + ${y}`, `${d2} = ${mt}(x + ${y})`, `(${d2} + ${y}) * ${mt} = x + ${y}`]};
    }
    ans = qO.a; document.getElementById('pg-problem-text').innerHTML = qO.q;
    var g = document.getElementById('pg-options'); g.innerHTML="";
    qO.o.sort(()=>Math.random()-0.5).forEach(o=>{
      var b=document.createElement('button'); b.className='pg-opt-btn'; b.innerHTML=o; b.onclick=function(){check(o,b)}; g.appendChild(b);
    });
  }

  function check(v, b) {
    if(!playing) return;
    document.querySelectorAll('.pg-opt-btn').forEach(x=>x.disabled=true);
    if(v===ans){
      score+=10; combo++; b.classList.add('pg-correct'); playBeep(523, 0.5);
      if(combo%3===0){ document.getElementById('turkey-overlay').classList.remove('turkey-hide'); document.getElementById('turkey-msg').innerText=`é€£å° ${combo} é¡Œï¼`; setTimeout(()=>document.getElementById('turkey-overlay').classList.add('turkey-hide'),1200); }
    } else {
      score-=5; combo=0; b.classList.add('pg-wrong'); playBeep(150, 0.5);
      document.querySelectorAll('.pg-opt-btn').forEach(x=>{if(x.innerHTML===ans)x.classList.add('pg-correct')});
    }
    document.getElementById('pg-score').innerText=score;
    document.getElementById('pg-combo-num').innerText=combo;
    document.getElementById('pg-combo-box').className = combo>=2 ? "" : "combo-hide";
    setTimeout(generate, 1200);
  }

  return {
    start: function() {
      if(!document.getElementById('pg-class').value) return alert("è«‹è¼¸å…¥ç­ç´š");
      initAudio(); playing=true;
      document.getElementById('pg-login-view').style.display='none';
      document.getElementById('pg-game-view').style.display='block';
      speak("æŒ‘æˆ°é–‹å§‹"); generate();
      timer = setInterval(function(){
        time--; document.getElementById('pg-timer').innerText=time;
        if(time<=10 && time>0) speak(time);
        if(time<=0){ clearInterval(timer); playing=false;
          document.getElementById('pg-game-view').style.display='none';
          document.getElementById('pg-result-view').style.display='block';
          document.getElementById('pg-final-score-num').innerText=score;
          document.getElementById('pg-final-student-id').innerText = document.getElementById('pg-class').value + "ç­" + document.getElementById('pg-seat').value + "è™Ÿ";
          speak("æ™‚é–“åˆ°ï¼ŒæŒ‘æˆ°çµæŸ");
        }
      },1000);
    }
  };
})();

// æœ€é«˜ç­‰ç´šé˜²è­·
(function() {
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
        if (e.keyCode == 123 || (e.ctrlKey && (e.shiftKey && (e.keyCode == 73 || e.keyCode == 74) || e.keyCode == 85 || e.keyCode == 83))) e.preventDefault();
    });
})();
</script>
</body>
</html>
